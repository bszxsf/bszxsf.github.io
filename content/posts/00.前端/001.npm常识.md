---
published: 2025-03-17T13:21+0800
modified: 2025-07-13T20:49+0800

tags:
  - 前端
  - 实用工具
---

# npm常识

npm是node.js开发中使用的一种工具，主要用于包管理用途，也可以做一些其他事情，例如执行框架提供的工具。

## 安装和执行工具

安装工具有两种办法：全局安装和临时安装并执行。

### 全局安装

执行：

```bash
npm i -g 工具名称
```

之后，该工具就永久在你的主机上存在，直到手动删除。可以在终端执行该工具，和其他系统工具无异。

> **Note**：`npm i`等价于`npm install`。

### 临时安装

执行：

```bash
npx 工具名称 [工具选项...]
```

该指令会直接安装对应工具并以提供的选项执行。在不用的时候，工具会被卸载，不会一直占用主机空间。

## 升级node

许多操作系统默认源的Node.js不是最新的，甚至可能远低于项目需求。好消息是升级非常简单：

```bash
sudo npm install -g n
sudo n stable
```

这会安装最新的稳定版本Node.js。将`stable`替换为`latest`可安装最新版本。

> **Note**：很少有人会直接用`npx`来管理Node.js版本，主要是因为`n`工具的用途主要是版本管理，它会在本地存储一些信息；还可以在本地切换不同版本。对于这样一个需要持久化存储的工具而言，用`npx`临时使用并不是一个常见的实践。

## 依赖管理

npm的依赖管理涉及两部分：`package.json`和`package-lock.json`。其中`package.json`只涉及用户指定要求的包，这些包间接依赖的包则位于`package-lock.json`。

### 添加依赖和开发依赖

npm中，依赖项分为两种：`dependencies`和`devDependencies`。前者是项目本身依赖的包，通过`npm i`安装。后者是只有开发模式依赖的包，例如eslint，通过`npm i -D`安装。像eslint这类只对开发过程起作用的包不应被安装到普通依赖，否则只是平白浪费空间而已，在安装前应仔细查看依赖包的说明文档。

> **Note**：Node.js的早期版本中，还需要为普通依赖添加`--save`选项（`-D`相当于`--save-dev`），其作用是将依赖添加到`package.json`；没有它的话，npm只会把包下载到`node_modules`。现在的版本中则相当于自动添加这个选项，所以读者不需要再手动添加。

### 移除依赖

使用`npm uninstall`可将依赖项移除掉，不论是哪种依赖项。

> **Note**：和安装依赖类似，早期版本需要`--save`选项，但现在不需要了。

### 升级依赖，并避免破坏性更新

通过`npm update`可以升级`package-lock.json`的内容，并且不会改变`package.json`。它会在尊重后者的设定的基础上尽可能把所有依赖升级到最新稳定版本，通常而言，这意味着整个项目所依赖的API不会有什么变化。

### 升级一切依赖

通过`npm-check-updates`（注意，这是一个独立的包，并不包含在node.js安装中，需要手动下载）并携带`-u`选项可以升级`package.json`的内容，进行破坏性更新，将一切内容升级到最新。它不会实际进行安装，因此执行过后还需要`npm i`进行安装。

此外，如果加上`--dep dev`选项（`npm-check-updates -u --dep dev`）可以只升级开发依赖，同样会引入破坏性更新，并且需要执行`npm i`。

这样升级可能带来破坏性更新，使得部分组件需要重写，但也能更好地避免旧版本依赖包中的bug。
